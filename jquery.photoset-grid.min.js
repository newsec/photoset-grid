/**
 * photoset-grid - v1.0.0
 * 2013-03-07
 * jQuery plugin to arrange images into a flexible grid
 * http://stylehatch.github.com/photoset-grid/
 *
 * Copyright 2013 Jonathan Moore - Style Hatch
 */
(function(e,t,n,r){"use strict";function o(t,n){this.element=t;this.options=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="photosetGrid",s={width:"100%",gutter:"0px",highresLinks:false,lowresWidth:500,rel:"",onInit:function(){},onComplete:function(){}};o.prototype={init:function(){this.options.onInit();this._setupRows(this.element,this.options);this._setupColumns(this.element,this.options)},_callback:function(){this.options.onComplete()},_setupRows:function(t,n){if(n.layout){this.layout=n.layout}else if(e(t).attr("data-layout")){this.layout=e(t).attr("data-layout")}else{var r="";var i=1;for(var s=0;s<e(t).find("img").length;s++){r=r+i.toString()}this.layout=r}this.rows=this.layout.split("");for(var o in this.rows){this.rows[o]=parseInt(this.rows[o],10)}var u=e(t).find("img");var a=0;e.each(this.rows,function(e,t){var n=a;var r=a+t;u.slice(n,r).wrapAll('<div class="photoset-row cols-'+t+'"></div>');a=r});e(t).find(".photoset-row:not(:last-child)").css({"margin-bottom":n.gutter})},_setupColumns:function(n,r){var i=this;var s=function(){function a(){var t=e(n).width().toString();if(t!==e(n).attr("data-width")){i.each(function(){var t=e(this).find("img:eq(0)");e(this).find("img").each(function(){var n=e(this);if(n.height()<t.height()){t=e(this)}if(n.width()>r.lowresWidth&&n.attr("data-highres")){n.attr("src",n.attr("data-highres"))}});var n=t.height();var i=Math.floor(n*.025);e(this).height(n-i);e(this).find("img").each(function(){var t=(n-e(this).height())*.5+"px";e(this).css({"margin-top":t})})});e(n).attr("data-width",t)}}var i=e(n).find(".photoset-row");var s=e(n).find("img");if(r.highresLinks){s.each(function(){var t;if(e(this).attr("data-highres")){t=e(this).attr("data-highres")}else{t=e(this).attr("src")}e(this).wrapAll('<a href="'+t+'" class="photoset-cell highres-link" />')});if(r.rel){s.parent().attr("rel",r.rel)}}else{s.each(function(){e(this).wrapAll('<div class="photoset-cell" />')})}var o=e(n).find(".photoset-cell");e(n).css({width:r.width});i.css({clear:"left",display:"block",overflow:"hidden"});o.css({"float":"left",display:"block","line-height":"0","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"});s.css({width:"100%",height:"auto"});i.each(function(){var t=e(this).find(".photoset-cell").length,n=Math.floor(100/t*100)/100;e(this).find(".photoset-cell").css({width:n+"%"})});var u=parseInt(r.gutter,10);e(n).find(".photoset-cell:not(:last-child)").css({"padding-right":u/2+"px"});e(n).find(".photoset-cell:not(:first-child)").css({"padding-left":u/2+"px"});a();e(t).on("resize",function(){a()})};e(n).imagesLoaded(function(){s();i._callback()})}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})};var u="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(t){function c(){var r=e(f),s=e(l);if(i){if(l.length){i.reject(o,r,s)}else{i.resolve(o)}}if(e.isFunction(t)){t.call(n,o,r,s)}}function h(e){p(e.target,e.type==="error")}function p(t,n){if(t.src===u||e.inArray(t,a)!==-1){return}a.push(t);if(n){l.push(t)}else{f.push(t)}e.data(t,"imagesLoaded",{isBroken:n,src:t.src});if(s){i.notifyWith(e(t),[n,o,e(f),e(l)])}if(o.length===a.length){setTimeout(c);o.unbind(".imagesLoaded",h)}}var n=this,i=e.isFunction(e.Deferred)?e.Deferred():0,s=e.isFunction(i.notify),o=n.find("img").add(n.filter("img")),a=[],f=[],l=[];if(e.isPlainObject(t)){e.each(t,function(e,n){if(e==="callback"){t=n}else if(i){i[e](n)}})}if(!o.length){c()}else{o.bind("load.imagesLoaded error.imagesLoaded",h).each(function(t,n){var i=n.src;var s=e.data(n,"imagesLoaded");if(s&&s.src===i){p(n,s.isBroken);return}if(n.complete&&n.naturalWidth!==r){p(n,n.naturalWidth===0||n.naturalHeight===0);return}if(n.readyState||n.complete){n.src=u;n.src=i}})}return i?i.promise(n):n};var a=e.event,f,l={_:0},c=0,h,p;f=a.special.throttledresize={setup:function(){e(this).on("resize",f.handler)},teardown:function(){e(this).off("resize",f.handler)},handler:function(t,n){var r=this,i=arguments;h=true;if(!p){setInterval(function(){c++;if(c>f.threshold&&h||n){t.type="throttledresize";a.dispatch.apply(r,i);h=false;c=0}if(c>9){e(l).stop();p=false;c=0}},30);p=true}},threshold:0}})(jQuery,window,document);